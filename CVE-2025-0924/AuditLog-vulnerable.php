<?php
class AuditLog {
    /*
    * Ajax callback to display meta data_inspector.
    */
    public function AjaxInspector() {
        if ( ! Settings_Helper::current_user_can( 'view' ) ) {
            die( 'Access Denied.' );
        }
        
        // Filter $_GET array for security.
        $get_array = filter_input_array( INPUT_GET );

        if ( ! isset( $get_array['occurrence'] ) ) {
            die( 'Occurrence parameter expected.' );
        }

        $wsal_db = Connection::get_connection();
        $alert_meta = Occurrences_Entity::get_meta_array( (int) $get_array['occurrence'], array(), $wsal_db );
        unset( $alert_meta['ReportText'] );

        echo '<div class="event-content-wrapper">';

        foreach ( $alert_meta as $item => $value ) {
            if ( $value ) {
                if ( is_array( $value ) || is_object( $value ) ) {
                    $value = var_export( $value, true );
                }
                // VULNERABLE LINE: Direct output without escaping
                echo '<strong>' . $item . ':</strong> <span style="opacity: 0.7;"><pre style="display:inline">' . $value . '</pre></span></br>';
            }
        }
        echo '</div>';
        wp_die();
    }
}
?>
