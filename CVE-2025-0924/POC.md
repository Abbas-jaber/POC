## Vulnerability Overview

CVE-2025-0924 is a Stored Cross-Site Scripting (XSS) vulnerability in the WP Activity Log plugin for WordPress. The vulnerability allows attackers to inject malicious scripts that persist in the activity logs and execute when administrators view the log details.

### Vulnerability Classification
- **CWE-79:** Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')
- **Type:** Stored XSS
- **Impact:** Privilege escalation, session hijacking, administrative access

### Affected Components
- **Plugin:** WP Activity Log
- **Versions:** 5.2.2 and below
- **Vulnerable Parameter:** `message` parameter in metadata
- **Fixed Version:** 5.3.0

---
## Visual Demonstration
Note: A proof-of-concept video demonstrating the complete exploitation chain is available from Chinese security researcher stupidfish001:
<img src="https://private-user-images.githubusercontent.com/131514744/415505761-79e208a1-6d2d-4f11-9a0f-508abf178cc5.gif?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NjEyMDU1MzAsIm5iZiI6MTc2MTIwNTIzMCwicGF0aCI6Ii8xMzE1MTQ3NDQvNDE1NTA1NzYxLTc5ZTIwOGExLTZkMmQtNGYxMS05YTBmLTUwOGFiZjE3OGNjNS5naWY_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUxMDIzJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MTAyM1QwNzQwMzBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0yMTZhZjM0NWJjMWQ5MDhlZGNmYzEwYzFkMTkxZjU3NTg2Y2ZmZTA0OWMzNDZlODkyNWNmMGRmZGQwYjAwZWI1JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.9o7r8XORXU3z2R732HYNAXxLS_AtlkVW3Ax2BC7bpCY" alt="이미지 설명" style="max-width: 100%; display: inline-block;" data-target="animated-image.originalImage">
---
<img src="https://private-user-images.githubusercontent.com/131514744/415507929-478bec9f-51de-416b-ae71-a8bc0d414d55.gif?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NjEyMDU1MzAsIm5iZiI6MTc2MTIwNTIzMCwicGF0aCI6Ii8xMzE1MTQ3NDQvNDE1NTA3OTI5LTQ3OGJlYzlmLTUxZGUtNDE2Yi1hZTcxLWE4YmMwZDQxNGQ1NS5naWY_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUxMDIzJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MTAyM1QwNzQwMzBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0wMzg3M2NmYTMzMGJlZTYzMGRjYWJjNjhjNmVhOGI3N2U5ZmM2MzYyMzFjYzQzODc2ODBkZGQ0MjI5MGQzNDgyJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.0reXvbI9Qj-XdpGiUsoZxVAwkadbUnNsbrBZK_qZu24" alt="이미지 설명" style="max-width: 100%; display: inline-block;" data-target="animated-image.originalImage">
## Technical Analysis

### Attack Flow
1. **Initial Injection:** Attacker creates WordPress content with malicious scripts
2. **Log Generation:** WP Activity Log records the activity with unsanitized input
3. **Trigger Point:** Administrator views log details through "More details..." feature
4. **Execution:** Malicious script executes in administrator's browser context

### Vulnerability Root Cause
The vulnerability occurs in the `AjaxInspector()` function within `AuditLog.php`, where user-supplied metadata is returned without proper output escaping using `esc_html()`.

<img width="1110" height="816" alt="image" src="https://github.com/user-attachments/assets/3123632b-908a-45c5-9aad-dd4441acfc30" />

```php
// Vulnerable code in AuditLog.php (v5.2.2)
public function AjaxInspector() {
    $occurrence = $this->get_occurrence();
    $metadata = $occurrence->get_meta_array();
    // Missing esc_html() sanitization
    return $metadata;
}
```
<img width="1161" height="142" alt="image" src="https://github.com/user-attachments/assets/4252bc54-a7a4-419f-8ab8-8d252883656d" />

### Attack Demonstration
# Step 1: Create Malicious Content
Navigate to WordPress Posts → Add New

Insert XSS payload in post title or content:

```
<script>alert('XSS via WP Activity Log')</script>
<img src=x onerror=alert('Stored XSS')>
```
# Step 2: Trigger Log Generation
Save/publish the post

WP Activity Log automatically records the activity

Malicious script is stored in the activity log database

# Step 3: Execute Payload
Navigate to WP Activity Log → Activity Log

Locate the logged post creation activity

Click "More details..." to view metadata

XSS payload executes in administrator context
