# Windows Disk Cleanup Privilege Escalation Exploit

## Vulnerability Overview

The new version of `cleanmgr.exe` includes a call to the `SetProcessMitigationPolicy` function, which introduces security enhancements but can still be bypassed under specific conditions.

## Technical Analysis

### Mitigation Policy Implementation
```cpp
SetProcessMitigationPolicy(MitigationPolicy, 16);
```
With MitigationPolicy set to 16, this corresponds to ProcessRedirectionTrustPolicy, indicating that cleanmgr.exe has Redirection Guard enabled.

### Vulnerability Classification

This vulnerability relates to CWE-59: Improper Link Resolution Before File Access ('Link Following'), where the Redirection Guard can be bypassed through specific techniques.

### Research Background
Based on research from security researchers Simon Zuckerbraun and enigma0x3:

Simon Zuckerbraun: "From Arbitrary Folder Delete/Move/Rename to SYSTEM EoP"

enigma0x3: "Bypass UAC"

### Key Insight
The SilentCleanup task possesses sufficient privileges to delete the C:/Config.msi folder. The exploitation requires finding an Arbitrary Folder Delete/Move/Rename vulnerability within the SilentCleanup task, which runs cleanmgr.exe with "Run with highest privileges".

### Behavioral Analysis via Procmon
Initial Observations
When running the SilentCleanup task and monitoring cleanmgr.exe behavior:

<img width="1024" height="589" alt="image" src="https://github.com/user-attachments/assets/12affe8c-e75c-4852-a489-70fad29655ac" />


The process checks for the existence of specific folders:

Verifies if listed folders exist

Note: Does not verify if C:\ESD is a junction

Does check Windows and Download folders (though this aspect isn't deeply explored here)

Folder Structure Setup
Create the following folder structure:
